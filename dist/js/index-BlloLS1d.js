import{p as e,r as t,q as a,s as i,v as l,t as n,d as s,x as o,y as d,F as r,A as c,b as f,e as u,B as p,C as m,D as v,G as w,o as y,H as g,I as h,J as x,K as b,L as S,M as k,N as j,O as N}from"./vendor-CCY7i31I.js";import{_ as E}from"./index-MEz1eM7L.js";const C="treeStore",O="edgeStore",J=e("treeDB",1,{upgrade(e){e.createObjectStore(C,{keyPath:"id"}),e.createObjectStore(O,{keyPath:"id"})}}),z=()=>{const e=t([]),s=t([]),o=t(!0),d=async()=>{for(;!o.value;)await new Promise((e=>setTimeout(e,100)));return o.value};a((async()=>{await(async()=>{o.value=!1;const t=await J,a=t.transaction(C,"readonly").objectStore(C);e.value=await a.getAll();const i=t.transaction(O,"readonly").objectStore(O);s.value=await i.getAll(),o.value=!0})()})),i((()=>{J.then((e=>e.close()))}));return{getTreeData:async()=>(await d(),e.value),getEdgeData:async()=>(await d(),s.value),addNode:async t=>{const a=(await J).transaction(C,"readwrite").objectStore(C);t.id=l(),t.createTime=(new Date).toLocaleString(),t.updateTime=(new Date).toLocaleString(),await a.add(JSON.parse(JSON.stringify(t))),e.value.push(JSON.parse(JSON.stringify(t))),n.success("添加成功")},addEdge:async e=>{const t=(await J).transaction(O,"readwrite").objectStore(O);e.id=l(),await t.add(JSON.parse(JSON.stringify(e))),s.value.push(JSON.parse(JSON.stringify(e))),n.success("添加成功")},updateNode:async t=>{const a=(await J).transaction(C,"readwrite").objectStore(C);t.updateTime=(new Date).toLocaleString(),t.isEdit&&delete t.isEdit;const i=e.value.find((e=>e.id===t.id));i&&(i.name=t.name,await a.put(JSON.parse(JSON.stringify(i))),n.success("保存成功"))},updateEdge:async e=>{const t=(await J).transaction(O,"readwrite").objectStore(O),a=s.value.find((t=>t.id===e.id));a&&(a.content=e.content,await t.put(JSON.parse(JSON.stringify(a))),n.success("保存成功"))},deleteNode:async t=>{const a=await J,i=a.transaction(C,"readwrite").objectStore(C);await i.delete(t),e.value=e.value.filter((e=>e.id!==t));const l=a.transaction(O,"readwrite").objectStore(O),o=await l.getAll();for(const e of o)e.parentId===t&&(await l.delete(e.id),s.value=s.value.filter((t=>t.id!==e.id)));n.success("删除成功")},deleteEdge:async e=>{const t=(await J).transaction(O,"readwrite").objectStore(O);await t.delete(e),s.value=s.value.filter((t=>t.id!==e)),n.success("删除成功")}}};const _={class:"container_box w-full h-full flex items-stretch gap-[20px]"},T={class:"classify_box w-[200px]"},V=["onClick"],D={class:"flex items-center gap-[10px]"},I={key:0,class:"flex items-center"},U={class:"w-[40px] h-[40px] flex items-center justify-center"},A={class:"notes_box flex-1 grid grid-cols-3 gap-10"},B={class:"w-full h-full relative z-[9]"},K={class:"h-10 bg-[#ffffff] relative top-[-10px] pt-[10px] pl-3 flex items-center rounded-md gap-3"},L=E(s({__name:"index",setup(e){const i={menubar:!1,toolbar:!1,statusbar:!1,language:"zh_CN",width:"100%",height:"100%",content_css:"dark"},{getTreeData:l,getEdgeData:n,addNode:s,addEdge:E,updateNode:C,updateEdge:O,deleteNode:J,deleteEdge:L}=z(),P=t([]),q=t([]),M=t([]),F=async()=>{P.value=await l(),q.value=await n(),M.value=function(e,t,a,i,l){t=t||"id",a=a||"parentId",l=l||Math.min(...e.map((e=>e[a])));const n=JSON.parse(JSON.stringify(e)),s=n.filter((e=>{const i=n.filter((i=>e[t]===i[a]));return i.length>0&&(e.children=i),e[a]===l}));return""!==s?s:e}([...P.value,...q.value],"id","parentId",0,"0").sort(((e,t)=>new Date(e.createTime).getTime()-new Date(t.createTime).getTime()))},G=t(1),H=t([]),W=e=>{G.value=e.id,H.value=e?.children||[]},Q=t(!1),R=t({id:0,name:"",parentId:"0"}),X=()=>{Q.value=!0},Y=async()=>{R.value.name?(await s(R.value),await F(),Q.value=!1):Q.value=!1},Z=()=>{H.value.push({id:"0",parentId:G.value,content:""})};return a((async()=>{await F(),M.value[0]||(await s({id:1,name:"默认分类",parentId:"0"}),await F()),W(M.value[0])})),(e,t)=>{const a=w;return y(),o("div",_,[d("div",T,[(y(!0),o(r,null,c(f(M),(e=>(y(),o("div",{class:g(["classify_item py-2 text-center cursor-pointer flex items-center justify-between",f(G)==e.id?" text-[#ffffff]":""]),key:e.id,onClick:t=>W(e)},[d("div",D,[d("div",{class:g(["w-[40px] h-[40px] flex items-center justify-center",f(G)==e.id?" bg-[var(--primary-100)] text-[#ffffff] rounded-xl":""])},[h(u(f(b),{type:"category-management",size:"24",theme:"outline",fill:"#454545"},null,512),[[x,f(G)!=e.id]]),h(u(f(b),{type:"category-management",size:"24",theme:"outline",fill:"#ffffff"},null,512),[[x,f(G)==e.id]])],2),d("div",{class:g(f(G)==e.id?"text-[#ffffff]":"text-[var(--text-200)]")},[h(d("span",null,S(e.name),513),[[x,!e.isEdit]]),h(d("div",null,[u(a,{modelValue:e.name,"onUpdate:modelValue":t=>e.name=t,onKeydown:p((t=>(async e=>{await C(e),e.isEdit=!1})(e)),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeydown"])],512),[[x,e.isEdit]])],2)]),d("div",{class:g(["delete_icon gap-3",e.isEdit?"noVisible":""])},[u(f(b),{type:"edit",size:"12",theme:"outline",fill:"#ffffff",onClick:k((t=>(e=>{e.isEdit=!0})(e)),["stop"])},null,8,["onClick"]),u(f(b),{type:"close",size:"12",theme:"outline",fill:"#ffffff",onClick:k((t=>{return a=e.id,void N.confirm("此操作将永久删除该分类, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",showClose:!1,appendTo:"body",type:"warning"}).then((async()=>{await J(a),await F(),W(M.value[0])}));var a}),["stop"])},null,8,["onClick"])],2)],10,V)))),128)),d("div",{class:"add_btn w-[60px] h-[60px] rounded-full bg-[#454545] hover:bg-[#0085ff] flex items-center justify-center fixed bottom-4 left-4 cursor-pointer",onClick:X},[u(f(b),{type:"other",size:"28",theme:"outline",fill:["#ffffff"]})]),f(Q)?(y(),o("div",I,[d("div",U,[u(f(b),{type:"category-management",size:"24",theme:"outline",fill:"#ffffff"})]),d("div",null,[u(a,{modelValue:f(R).name,"onUpdate:modelValue":t[0]||(t[0]=e=>f(R).name=e),onKeydown:p(Y,["enter"])},null,8,["modelValue"])]),d("div",null,[u(f(b),{type:"close",size:"12",theme:"outline",fill:"#ffffff",onClick:t[1]||(t[1]=e=>(Q.value=!1,f(R).name=""))})])])):m("",!0)]),t[3]||(t[3]=d("div",{class:"line w-[1px] h-full bg-white"},null,-1)),d("div",A,[f(H).length?m("",!0):(y(),o("div",{key:0,class:"w-3/6 h-3/6 border-2 border-slate-300 flex items-center justify-center rounded flex-col gap-4 text-white text-2xl cursor-pointer",onClick:Z},[u(f(b),{type:"doc-add",size:"100",theme:"outline",fill:"#ffffff",strokeWidth:1}),t[2]||(t[2]=v(" 新建便签 "))])),f(H).length?(y(),o("div",{key:1,class:"add_btn w-[60px] h-[60px] rounded-full bg-[#454545] hover:bg-[#0085ff] flex items-center justify-center fixed top-4 right-4 cursor-pointer z-10",onClick:Z},[u(f(b),{type:"doc-add",size:"24",theme:"outline",fill:"#ffffff"})])):m("",!0),(y(!0),o(r,null,c(f(H),((e,t)=>(y(),o("div",{key:e.id,class:"h-[450px]"},[d("div",B,[u(f(j),{modelValue:e.content,"onUpdate:modelValue":t=>e.content=t,"api-key":"e20g4kwvhjp4y0xwbf2ibe73qieph0k4y1um8xo5jl13j0f4",init:i},null,8,["modelValue","onUpdate:modelValue"])]),d("div",K,[u(f(b),{class:"cursor-pointer",type:"save",size:"20",theme:"outline",fill:"#1E1E1E",onClick:t=>(async e=>{const t=e;"0"===t.id?await E({id:"0",parentId:G.value,content:t.content}):await O(t)})(e)},null,8,["onClick"]),u(f(b),{class:"cursor-pointer",type:"delete-themes",size:"20",theme:"outline",fill:"#1E1E1E",onClick:e=>(async e=>{"0"===H.value[e].id||await L(H.value[e].id),H.value.splice(e,1)})(t)},null,8,["onClick"])])])))),128))])])}}}),[["__scopeId","data-v-2ee30113"]]);export{L as default};
